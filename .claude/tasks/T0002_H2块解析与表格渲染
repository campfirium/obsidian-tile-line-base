# T0002: H2 块解析与表格渲染

**状态：** 进行中
**分支：** feat/T0002-h2-parser-table
**积木编号：** 积木 3-5 合并（一步到位）

## 学习目标

- 理解"模板H2"模式的核心原理
- 掌握文本解析和结构化数据提取
- 学习如何将解析结果渲染成表格
- 处理边界情况（空段落、不规则块等）

## 功能描述

实现完整的 H2 块解析和表格渲染功能：

### 解析规则（模板H2模式）

1. **第一个 `## H2` 块 = 模板（Schema）**
   - H2 标题 → 第一列的列名
   - 每个段落 → 后续列的列名
   - 确定总列数

2. **后续 `## H2` 块 = 数据**
   - H2 标题 → 第一列的值
   - 每个段落 → 后续列的值

3. **空值处理**
   - 空段落或单独的 `.` 表示空单元格

### 示例输入

```markdown
## 任务名称
负责人
状态
截止日期

## 学习插件开发
张三
进行中
2024-12-31

## 设计 Logo
李四
待处理
2024-11-30

## 撰写文档
王五
已完成
.
```

### 预期输出

| 任务名称 | 负责人 | 状态 | 截止日期 |
| --- | --- | --- | --- |
| 学习插件开发 | 张三 | 进行中 | 2024-12-31 |
| 设计 Logo | 李四 | 待处理 | 2024-11-30 |
| 撰写文档 | 王五 | 已完成 | |

## 完成标准

- [ ] 能正确识别所有 ## H2 块
- [ ] 从第一个 H2 块提取 Schema（列名）
- [ ] 从后续 H2 块提取数据行
- [ ] 表格正确显示列名和数据
- [ ] 空段落显示为空单元格
- [ ] 处理文件开头没有 H2 的情况
- [ ] 处理连续 H2（没有段落）的情况

## 技术要点

### 数据结构

```typescript
// H2 块
interface H2Block {
  title: string;        // H2 标题（去掉 ## ）
  paragraphs: string[]; // 段落数组（每行一个）
}

// Schema
interface Schema {
  columnNames: string[]; // 所有列名
}

// 表格数据
type TableData = string[][]; // 二维数组
```

### 核心算法

1. **分割 H2 块**
   - 遍历所有行
   - 遇到 `## ` 开头的行，开始新块
   - 非空行添加到当前块的段落数组

2. **提取 Schema**
   - 第一个 H2 块的标题 → columnNames[0]
   - 第一个 H2 块的段落 → columnNames[1...n]

3. **提取数据**
   - 从第二个 H2 块开始
   - 每个块的标题和段落 → 一行数据
   - 段落不足时补空字符串

## 边界情况处理

1. **文件开头无 H2**
   - 忽略 H2 之前的所有内容

2. **连续 H2（无段落）**
   - 视为该记录所有字段为空

3. **段落数量不匹配**
   - 少了：补空字符串
   - 多了：忽略超出部分（或显示警告）

4. **空文件或无 H2**
   - 显示提示："此文件不包含 H2 块"

## 参考文档

- [H2 段落解析规范](../docs/H2%20段落解析.md)

## 下一步

完成后继续：
- 积木 6：可编辑单元格
- 积木 7：写回文件
