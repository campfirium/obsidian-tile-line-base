# 项目设计书：TileLineBase 6

**版本：** 6.0 (The Definitive Blueprint)  
**文档状态：** 最终战略、架构与功能集敲定

### **第一章：项目概述与愿景**

- **1.1 项目名称:** **TileLineBase**
  - **Tile:** 代表**可视化的、可组合的单元** (看板、画廊)。
  - **Line:** 代表**线性的、有顺序的结构** (大纲、卡片流) 和“行即原子”的技术内核。
  - **Base:** 代表**强大、可靠的底层数据库引擎** (表格、全局索引)。
- **1.2 项目定位:** 一个名为 **TileLineBase** 的**“联邦式段落数据库”系统**，旨在**重新定义 Obsidian 的结构化能力**。
- **1.3 项目愿景:** 通过一个**完全摆脱 Frontmatter 束缚**的、**原生内联**的数据库系统，为用户提供一个集**深度工作、宏观规划、知识内化、流程管理**于一体的、终极的个人生产力操作系统。
- **1.4 核心理念:**
  - **双层架构:** 微观的“单文件数据库”与宏观的“全局索引数据库”和谐共生。
  - **行即原子:** 插件操作的最小物理单位是“行”，逻辑单位是 ## H2 记录。
  - **无感结构化:** 拒绝 Frontmatter，所有数据与结构都在内容流中自然完成。
  - **数据联邦:** 尊重数据的物理分离，但在逻辑上实现无缝的全局聚合。

---

### **第二章：数据模型与核心架构**

- **2.1 核心架构: “行即原子，内存驱动”**
  - 内存中维护一个**行字符串数组 (string[])**作为源文件的实时镜像，所有 UI 交互都通过操作此数组完成。
- **2.2 记录单位 (Row):**
  - 逻辑分隔符为 ## H2。一个逻辑记录在内存中表现为对“行数组”中一组连续元素的引用。
- **2.3 结构模板 (Schema):**
  - **第一个 ## H2 块**作为“模板”，其标题和段落（行）定义列名和列数。
- **2.4 空值 (Null Value):**
  - 一个空的段落（行）被视为空的单元格值。
- **2.5 公式列 (Formula Field):**
  - 在模板中通过 列名: = {公式} 格式声明，使用**花括号 {}**引用变量。计算结果动态生成，不写回源文件。
- **2.6 可切换的数据范式 (Switchable Data Paradigm):**
  - **简洁范式 (默认):** Schema 只在第一个 H2 模板中定义一次。为人类编辑优化。
  - **冗余范式 (可选):** 在每一条 H2 记录内部，都重复包含其所有字段的名称（如 负责人: 张三）。为 AI 理解和跨应用导入/导出优化。插件将支持这两种范式间的无损转换。

---

### **第三章：视图系统 (The View System)**

#### **3.1 核心工作流视图 (Core Workflow Views)**

- **表格视图 (Table View):** **属性编辑器**。用于批量编辑、筛选、排序和量化决策。是 MVP 的绝对核心。
- **大纲视图 (Outline View):** **层级编辑器**。用于通过拖拽和缩进，直观地管理记录之间的父子关系 (父任务 字段)。
- **看板视图 (Kanban View):** **流程引擎**。根据 看板 字段的值，将记录动态分配到不同的列中，通过拖拽更新流程状态。
- **日历视图 (Calendar View):** **时间浏览器**。将带有“日期”字段的记录可视化地呈现在日历上，支持拖拽修改日期。

#### **3.2 远期视觉化视图 (Potential Future Views)**

- (这些视图将在核心工作流完善后，根据社区投票和反馈，有选择地实现)
- **画廊视图 (Gallery View):** 将记录渲染成网格状的图片卡片，封面自动抓取记录内的第一张图片。
- **地图视图 (Map View):** 将带有“位置”字段的记录，标注在可交互的地图上。
- **时间轴/甘特图视图 (Timeline/Gantt View):** 将带有“开始日期”和“结束日期”的记录，渲染成水平的时间轴。

---

### **第四章：模式系统 (The Mode System)**

- **4.1 格式校正模式 (Correction Mode):**
  - 在表格视图中激活，通过特殊的 UI (高亮、虚线) 标识出数据错位、缺失或多余的单元格。
  - 提供“**插入空单元格**”、“**删除单元格**”等直观的 UI 操作，来修正底层 Markdown 的行结构。
- **4.2 演示模式 (Presentation Mode):**
  - 一键将当前文件中的所有 ## H2 块，转换为一个简洁的幻灯片演示。
  - 每一页幻灯片对应一个 H2 块，支持用户**自定义 CSS** 来实现个性化的主题和样式，碾压传统 Slide 插件的体验。
- **4.3 闪卡模式 (Flashcard Mode):**
  - **Foliole 的预演版**。将 H2 记录转换为用于间隔重复的闪卡。
  - **FSRS 集成:** 在后台集成开源的 FSRS 算法，进行智能复习调度。
  - **数据存储:** 卡片的复习状态（fsrs-due, fsrs-stability 等）作为隐藏字段，直接写回 H2 记录块内，保证数据自包含。
- **4.4 AI 交互模式 (WYTIWYG) - 长期愿景:**
  - 提供一个自然语言输入框，用户可以通过输入“给我看看张三所有没完成的任务”，来直接驱动表格的筛选和排序。

---

### **第五章：全局系统 (The Global System)**

- **5.1 全局索引数据库 (The Macro-Database):**
  - 通过一个**轻量级的后台索引器**，增量地监听所有“微观数据库”文件的变化，建立一个高性能的全局索引。
  - 实现了**不依赖 Frontmatter 的、高性能的全局查询**。
- **5.2 全局聚合视图 (Global Views):**
  - **全局任务视图:** 聚合所有来源的、符合特定条件的任务。
  - **全局闪卡视图:** 提供一个统一的、全局的“今日复习”队列，由 FSRS 算法驱动。

---

### **第六章：技术架构与实现策略**

- **6.1 核心架构:** **“行即原子，内存驱动”**。
- **6.2 安全写回机制:** 采用 **Debounce (500ms) + Throttle (10s)** 的混合保存策略，通过**“镜像写回”**持久化数据。
- **6.3 性能挑战:** MVP 阶段的核心难点在于**大文件下的“全文重组与写回”性能**，需要进行算法优化。
- **6.4 健壮性与容错:** 采用务实策略，如**冲突时保存副本**、**IO 错误时清晰提示**、依赖**UI 即时反馈**让用户自查格式。
- **6.5 独立窗口模式 (Post-MVP):** 提供“在新窗口中打开工作台”的命令，以实现完美的、不受干扰的布局。

---

### **第七章：战略与研发路线图**

- **7.1 插件与 Foliole 的关系:** 本插件将作为 Foliole 的**技术预演、市场验证工具、以及最终的流量引擎**。通过战略性的功能保留（如不支持多媒体卡片、高级统计），引导核心用户向独立的 Foliole 应用转化。
- **7.2 研发路线图:**
  1. **第一阶段 (MVP): 锻造微观核心** -> 全力做好**终极表格视图**。
  2. **第二阶段 (构建宏观联邦):** 开发**“全局索引器”**和**“全局任务/闪卡视图”**，并集成 FSRS。
  3. **第三阶段 (完善核心工作流):** 依次加入**大纲视图、看板视图、日历视图**。
  4. **第四阶段 (扩展生态):** 根据社区投票，实现**演示模式**等高级模式和**画廊视图**等视觉化视图。
  5. **第五阶段 (迈向远方):** 启动独立的 **Foliole** 项目。

---

这份 V6.0 设计书，现在已经将我们所有讨论的细节，都以一种有条理、有优先级的方式，完整地、毫无保留地呈现了出来。它既是一份宏伟的蓝图，也是一份清晰的、可分步执行的行动计划。**这，就是我们的最终设计。**
