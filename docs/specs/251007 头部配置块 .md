## **规范文档：头部配置块 (Header Configuration Block)**

**版本：** 1.0
**状态：** 已敲定

### **1. 目的与哲学**

“头部配置块”是 TileLineBase 用于定义**数据库 Schema（结构）**和**视图元数据（格式化）**的唯一区域。其核心设计哲学是：
*   **数据与配置分离:** 将“规则”与“内容”清晰地隔离开。
*   **AI 安全:** 采用 AI 不会轻易修改的标准 Markdown 格式。
*   **极致紧凑与人类可读:** 语法必须简洁、直观、上下文关联强，避免大段的 YAML 带来的视觉干扰。

### **2. 物理格式：带语言标识符的代码块**

*   配置块必须使用标准的 Markdown Fenced Code Block（代码块）进行包裹。
*   该代码块的**语言标识符**必须为 **`tilelinebase`**。

**示例:**
```markdown
```tlb
# 所有的配置都写在这里
```

---
*（文件主体内容）*
```

### **3. 语法核心：“行内括号声明式语法”**

*   在 `tilelinebase` 代码块内部，**每一行代表一个列（字段）的定义**。
*   行首是**列的名称**（将作为表格的 `headerName`）。
*   列名之后，可以跟一个或多个由**圆括号 `()`** 包裹的**配置项**。

### **4. 配置项语法规则**

#### **4.1 键值对配置 (Key-Value Configuration)**

*   **格式:** `(key: value)`
*   `key` 和 `value` 之间由冒号 `:` 分隔，冒号后可有零个或多个空格。
*   `value` 如果包含空格，建议（但非强制）用引号包裹，例如 `(unit: "美 元")`。

*   **已定义的 `key` 及其 `value` 类型:**
    *   **`width`** (string): 定义列的宽度。
        *   **值:** 可以是百分比 (`"30%"`), 像素 (`"150px"`), 或关键字 `auto`。
    *   **`unit`** (string): 定义列的单位。
        *   **值:** 任意字符串，如 `"分钟"`, `"kg"`, `"￥"`。
        *   **作用:** 插件在解析数据时，会自动从单元格值中**剥离**此单位后缀。
    *   **`formula`** (string): 定义该列为**公式列**。
        *   **值:** 一个以 `=` 开头的字符串，内部使用**花括号 `{}`** 引用其他列的值。

#### **4.2 布尔开关配置 (Boolean Flag Configuration)**

*   **格式:** `(keyword)`
*   括号内只有一个**不包含冒号 `:` 的关键字**。
*   **作用:** 将该关键字对应的配置项设置为 `true`。

*   **已定义的 `keyword`:**
    *   **`hide`**: 在表格视图中默认隐藏这一列。

### **5. 公式 (`formula`) 语法的详细规则**

*   **变量引用:** 必须使用**花括号 `{}`** 包裹列名，如 `{价值}`。
*   **运算符:** 支持基础数学运算符 `+`, `-`, `*`, `/` 和用于控制优先级的圆括号 `()`。
*   **除法的简化格式化 (MVP 阶段):**
    *   **格式:** `{A} / ({B}, N)`
    *   **作用:** `N` 是一个整数，代表计算结果需要**四舍五入保留的小数位数**。
    *   **示例:** `({价值} / {成本}, 2)`
*   **安全保障:** 公式引擎在执行任何除法运算时，必须**内置安全检查**。如果分母为 0 或无效，必须返回一个安全的默认值（如 `0`），而不是导致程序错误。

### **6. 宽度 (`width`) 自适应规则**

1.  **完全默认:** 如果没有任何一列定义 `width`，则所有列**均分**可用宽度。
2.  **部分指定:** 插件首先满足所有指定了**具体宽度**（`px` 或 `%`）的列，然后将**剩余的可用宽度**，均分给所有未指定宽度或明确定义为 `(width: auto)` 的列。
3.  **内置最小宽度:** 插件在渲染时，应强制一个合理的最小列宽（如 `50px`），以保证可用性。此最小宽度为内部设定，无需用户配置。

### **7. 完整示例**

```markdown
```tilelinebase
任务名称 (width: 40%)
负责人 (width: 150px)
状态 (hide)
价值 (width: auto)
成本 (unit: 分钟) (width: auto)
优先级 (formula: = {价值}/{成本}, 2)
```

---

*（文件主体内容，采用 `Key: Value` 格式）*

## 任务: 设计 Logo
负责人: 李四
状态: 待处理
价值: 90
成本: 120 分钟
优先级: 0.74
```