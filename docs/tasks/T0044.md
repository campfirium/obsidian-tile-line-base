# T0044：新内容在过滤视图显示不及时

**状态**: 已完成
**分支**: feat/T0044-filter-view-refresh
**类型**: bug
**主题**: 过滤视图

## 问题描述

在过滤视图中，当进行以下操作时，新内容显示不及时：
- 复制行
- 新增行
- 修改数据

需要切换到文件视图再切回来才能正常显示更新的内容。

## 根本原因

TableView 中存在两个数据缓存层：
1. `this.blocks` - 数据的唯一真实来源
2. `this.allRowData` - 用于过滤视图的完整数据快照

问题在于：数据修改操作只更新了 `this.blocks`，但没有同步更新 `this.allRowData`，导致过滤视图仍然使用旧数据。

详细分析见：[T0044_analysis.md](T0044_analysis.md)

## 解决方案

1. 新增核心方法 `refreshGridData()`，统一处理数据刷新：
   - 从 `blocks` 重新提取完整数据到 `allRowData`
   - 根据当前激活的过滤视图重新应用过滤规则
   - 更新 AG Grid 显示

2. 在所有数据修改操作后调用 `refreshGridData()`：
   - `onCellEdit()` - 单元格编辑
   - `addRow()` - 新增行
   - `deleteRow()` / `deleteRows()` - 删除行
   - `duplicateRow()` / `duplicateRows()` - 复制行

## 修改文件

- `src/TableView.ts`
  - 新增 `refreshGridData()` 方法 (L1783-1810)
  - 修改 `onCellEdit()` (L1312)
  - 修改 `addRow()` (L1421)
  - 修改 `deleteRow()` (L1480)
  - 修改 `deleteRows()` (L1516)
  - 修改 `duplicateRow()` (L1603)
  - 修改 `duplicateRows()` (L1563)

## 测试建议

1. 在"全部"视图下测试增删改操作
2. 在过滤视图下测试：
   - 添加符合/不符合过滤条件的数据
   - 修改数据使其进入/离开过滤视图
   - 复制、删除操作
3. 切换视图时验证数据正确性

## 待办事项

- [x] 分析当前过滤视图的数据流和刷新机制
- [x] 识别缓存层级和刷新触发点
- [x] 设计理想的刷新机制
- [x] 实现自动刷新
- [x] 构建验证无编译错误
- [ ] 用户测试各种场景
