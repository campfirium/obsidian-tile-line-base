# 表格视图设计

### **新规则设定要点 (AI 安全与高级格式化)**

#### **1. “头部配置块 (Header Configuration Block)”**

*   **定义:** 在 `.md` 文件顶部，使用特殊的、AI 不易修改的分隔符（如 `%%%`）包裹一个配置区域。
*   **格式:** 内部使用 `YAML` 格式。
*   **职责:** 成为所有“**元数据**”和“**规则**”的唯一存放地，与下文的数据区完全分离。

#### **2. 公式列的处理方式：“写入结果，实时重算 (Write-Back Caching)”**

*   **定义:** 所有公式，都在“头部配置块”中定义（例如 `优先级: = {价值} / {成本}`）。
*   **文件存储:** 在 Markdown 的数据区 (`## H2` 块) 中，公式列只以其**上一次计算的结果（纯数值）**形式存在（例如 `优先级: 16.0`）。
*   **UI 行为:** 在插件的表格视图中，该列的值会根据公式**实时、动态地重新计算**并显示。
*   **保存行为:** 保存文件时，插件会将内存中**最新的计算结果**，作为纯数值写回文件。

#### **3. 列的格式化规则**

*   **定义:** 所有列的格式化规则，如**单位 (unit)**、**小数位数 (decimalPlaces)**等，都在“头部配置块”中定义。
*   **智能解析:** 插件在解析数据时，会根据头部定义，自动**剥离**单位（如从 `10分钟` 中提取 `10`）。
*   **智能渲染:** 插件在 UI 中显示数据时，会根据头部定义，自动**格式化**数值（如保留两位小数），并可选择性地将单位显示在列表头。

#### **4. 数据区的最终范式：“完全冗余，去模板化”**

*   **格式:** `.md` 文件的主体部分，**彻底废除“模板H2”**。所有 `## H2` 记录都采用统一的、自解释的 `Key: Value` 格式。
*   **Schema 生成:** 插件通过**动态扫描**所有记录，来构建内存中的列（Schema）。