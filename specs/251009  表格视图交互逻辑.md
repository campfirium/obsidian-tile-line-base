# 交互逻辑：表格视图 (TileLineBase)

> **目标日期：2025-10-09**  
> 本文记录表格视图 MVP 阶段的交互规范，指导后续实现与回归测试。

---

## 1. 行选择（Selection）
- **左键单击任意单元格**：选中该行，其余行取消选中。
- **右键单击**：在弹出上下文菜单前，需同步选中右键命中的那一行，避免误操作。
- **滚动同步**：调用任何“确保可见”的操作时，行需滚动至视口范围内（保持 1 行缓冲即可）。
- **删除后选中**：删除选中行后：
  - 若存在下一行，则选中下一行；
  - 若删除的是最后一行，则选中上一行；
  - 若表格为空，则清空选中状态。

## 2. 单元格编辑（Editing）
- **双击或 Enter**（内置）进入编辑模式。
- 完成编辑后需立刻写回 Markdown 数据并触发防抖保存（现有逻辑保留）。
- **新增/复制行后**：自动聚焦到该行的首个可编辑列，并进入编辑模式，方便立即录入。

## 3. 行操作（Row CRUD）

| 操作 | 触发方式 | 行为规范 |
| --- | --- | --- |
| 新增行 | - 右键菜单「在上方插入行 / 在下方插入行」<br>- （预留）工具栏/按钮 | - 根据触发位置插入新行<br>- 表格数据更新后，选中新行并滚动至视图内<br>- 自动进入第一可编辑列的编辑模式 |
| 复制行 | - 右键菜单「复制此行」<br>- 快捷键 `Ctrl/Cmd + D` | - 在原行之后插入拷贝行<br>- 复制完成后选中新行，滚动至视图内并聚焦首列编辑 |
| 删除行 | - 右键菜单「删除此行」 | - 无需弹窗确认（与当前实现保持一致）<br>- 删除后执行“删除后选中”策略，并滚动至新的选中行 |

## 4. 上下文菜单（Context Menu）
- 入口：右键单击数据行。
- 菜单项顺序：新增（上方 / 下方）→ 分隔线 → 复制 → 删除。
- 弹出前同步选中当前行；隐藏菜单后支持重复右键快速操作。

## 5. 键盘策略（Keyboard）
- 保持现状：禁用 Enter 插入新行、禁用 Delete/Backspace 删除整行。
- 保留 `Ctrl/Cmd + D` 复制行（触发同上表流程）。
- 若后续新增快捷键（如 `Ctrl + Enter` 新增行），需在此文补充。

## 6. 可访问性与视觉反馈
- 被选中行需要保持 AG Grid 默认高亮样式；如未来定制样式，应保持明显对比。
- 行滚动到视口时，若由于布局原因无法完全显示，至少保证首列可见。

---

**验证清单**
1. 移动视图到新窗口后最大化，执行新增/复制/删除，行高与选中状态均正确刷新。
2. 右键非当前选中行时，菜单操作作用于右键目标行。
3. 新增或复制后自动进入首列编辑，输入内容可立即写回 Markdown。
