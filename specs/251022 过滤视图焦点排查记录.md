# 过滤视图焦点排查记录

## 背景
- 场景：在过滤视图下新增条目时偶发失去焦点，导致无法立即继续录入。
- 目标：定位焦点丢失的原因，并给出可靠的修正方案。

## 失败尝试

### 尝试 1：在 `addRow` 后立即调用 `focusRow`
- **做法**：新增 `focusRow` 重试机制，记录目标行，等待 `modelUpdated` 后多次重试聚焦。
- **失败表现**：单独聚焦能稳定成功，但在 Enter 新增的链路里仍会出现“先聚焦 → 又丢失”的情况。
- **日志提示**：`[FocusDebug] attemptFocus: verification success` 之后仍看到 AG Grid 报警，焦点被后续逻辑打散。

### 尝试 2：强制进入编辑模式
- **做法**：在聚焦成功后调用 `api.startEditingCell`，试图“锁住”输入框。
- **失败表现**：虽然日志显示成功，但实际体验会被迫进入编辑模式，行为与原功能不符，被用户否定。
- **结论**：属于掩盖症状，未解决真正的焦点跳转问题。

### 尝试 3：沿用旧的 `tryEdit` 回调
- **背景**：旧版实现中保留了一段 `tryEdit`，直接以原始索引调用 `ensureIndexVisible` + `startEditingCell`。
- **失败表现**：在过滤视图下触发 AG Grid #88 / #290 警告（Invalid row index / Row not found），再次抢占焦点。
- **分析**：过滤后显示行索引与原始行数不一致，`tryEdit` 使用旧索引导致定位错误。

## 结论
- 真正问题源自“新增行后沿用原始索引进行 `ensureIndexVisible/startEditingCell`”，与过滤场景不兼容。
- 去掉该段 `tryEdit`，保留纯聚焦重试逻辑后，焦点恢复稳定，日志中不再出现 AG Grid #88/#290。

